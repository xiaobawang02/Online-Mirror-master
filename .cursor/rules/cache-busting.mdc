# ç¼“å­˜ç ´åç­–ç•¥(Cache Busting)

## ğŸ¯ ç›®çš„

è§£å†³ Cloudflare CDN å’Œæµè§ˆå™¨ç¼“å­˜å¯¼è‡´çš„é™æ€èµ„æºæ›´æ–°é—®é¢˜ã€‚

## ğŸ“‹ ç‰ˆæœ¬åŒ–åŠ è½½è§„èŒƒ

### config.js ç‰ˆæœ¬æ§åˆ¶

æ‰€æœ‰ HTML æ–‡ä»¶ä¸­çš„ config.js å¼•ç”¨å¿…é¡»åŒ…å«ç‰ˆæœ¬å·å‚æ•°:

```html
<!-- âœ… æ­£ç¡® -->
<script src="config.js?v=20251103"></script>

<!-- âŒ é”™è¯¯ -->
<script src="config.js"></script>
```

### ç‰ˆæœ¬å·æ ¼å¼

- æ ¼å¼: `YYYYMMDD`
- ç¤ºä¾‹: `20251103` (2025 å¹´ 11 æœˆ 3 æ—¥)
- æ¯æ¬¡ä¿®æ”¹ config.js æ—¶æ›´æ–°ç‰ˆæœ¬å·

## ğŸ”„ åˆ é™¤åŠŸèƒ½åˆ·æ–°ç­–ç•¥

### å¼ºåˆ¶åˆ·æ–°å®ç°

åˆ é™¤æ“ä½œæˆåŠŸå,ä½¿ç”¨å¸¦æ—¶é—´æˆ³çš„ URL å¼ºåˆ¶åˆ·æ–°:

```javascript
// âœ… æ­£ç¡® - å¼ºåˆ¶åˆ·æ–°,æ¸…é™¤ç¼“å­˜
window.location.href =
  window.location.href.split("?")[0] +
  "?id=" +
  encodeURIComponent(id) +
  "&_t=" +
  Date.now();

// âŒ é”™è¯¯ - å¯èƒ½ä½¿ç”¨ç¼“å­˜æ•°æ®
location.reload();
```

### API è¯·æ±‚ç¼“å­˜ç ´å

æ‰€æœ‰ API è¯·æ±‚å¿…é¡»ç¦ç”¨ç¼“å­˜,é˜²æ­¢æ˜¾ç¤ºè¿‡æœŸæ•°æ®:

```javascript
// âœ… æ­£ç¡® - æ·»åŠ æ—¶é—´æˆ³å‚æ•° + no-store é€‰é¡¹
const response = await fetch(
  `${API_URL}?id=${id}&page=${page}&_=${Date.now()}`,
  { cache: 'no-store' }
);

// âŒ é”™è¯¯ - å¯èƒ½ä½¿ç”¨ç¼“å­˜å“åº”
const response = await fetch(`${API_URL}?id=${id}&page=${page}`);
```

### æ—¶é—´æˆ³å‚æ•°

- å‚æ•°å: `_t` (é¡µé¢åˆ·æ–°) æˆ– `_` (APIè¯·æ±‚)
- å€¼: `Date.now()` (æ¯«ç§’çº§æ—¶é—´æˆ³)
- ä½œç”¨: ç»•è¿‡æµè§ˆå™¨å’Œ CDN ç¼“å­˜

## ğŸ“ æ›´æ–°æµç¨‹

### ä¿®æ”¹ config.js æ—¶

1. ä¿®æ”¹ `config.js` æ–‡ä»¶
2. æ›´æ–°æ‰€æœ‰ HTML æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å·
3. éƒ¨ç½²åˆ° Cloudflare Pages
4. (å¯é€‰) æ¸…é™¤ Cloudflare CDN ç¼“å­˜

### éœ€è¦æ›´æ–°ç‰ˆæœ¬å·çš„æ–‡ä»¶

- [home.html](mdc:home.html)
- [view.html](mdc:view.html)
- [camera.html](mdc:camera.html)
- [v.html](mdc:v.html)
- [test.html](mdc:test.html) (å¦‚æœå­˜åœ¨)

## ğŸš« æ³¨æ„äº‹é¡¹

1. **ä¸è¦å¿˜è®°æ›´æ–°ç‰ˆæœ¬å·**: ä¿®æ”¹ config.js åå¿…é¡»æ›´æ–°æ‰€æœ‰å¼•ç”¨å®ƒçš„ HTML æ–‡ä»¶
2. **ç»Ÿä¸€ç‰ˆæœ¬å·**: æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨ç›¸åŒçš„ç‰ˆæœ¬å·,ä¾¿äºç®¡ç†
3. **éƒ¨ç½²åæµ‹è¯•**: ä½¿ç”¨æ— ç—•æ¨¡å¼æˆ–æ¸…é™¤ç¼“å­˜åæµ‹è¯•åŠŸèƒ½
4. **API è¯·æ±‚ä¸ç¼“å­˜**: Worker API å“åº”å·²è®¾ç½® Cache-Control,æ— éœ€é¢å¤–å¤„ç†

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜: æ›´æ–°åä»æ˜¾ç¤ºæ—§æ•°æ®

**æ£€æŸ¥æ­¥éª¤**:

1. ç¡®è®¤ç‰ˆæœ¬å·å·²æ›´æ–°
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ (Ctrl+Shift+Delete)
3. ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•
4. æ£€æŸ¥ Cloudflare CDN ç¼“å­˜æ˜¯å¦æ¸…é™¤

### é—®é¢˜: åˆ é™¤åé¡µé¢ä¸åˆ·æ–°

**æ£€æŸ¥æ­¥éª¤**:

1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
2. ç¡®è®¤åˆ é™¤è¯·æ±‚è¿”å› `success: true`
3. æ£€æŸ¥åˆ·æ–°é€»è¾‘æ˜¯å¦ä½¿ç”¨æ—¶é—´æˆ³å‚æ•°
4. éªŒè¯ URL å‚æ•°æ˜¯å¦æ­£ç¡®æ‹¼æ¥

## ğŸ“Š Cloudflare CDN ç¼“å­˜æ¸…é™¤

### æ–¹æ³• 1: Dashboard (æ¨è)

1. ç™»å½• Cloudflare Dashboard
2. Pages â†’ online-mirror
3. éƒ¨ç½² â†’ æ¸…é™¤ç¼“å­˜

### æ–¹æ³• 2: API

```bash
curl -X POST "https://api.cloudflare.com/client/v4/zones/YOUR_ZONE_ID/purge_cache" \
  -H "Authorization: Bearer YOUR_API_TOKEN" \
  -H "Content-Type: application/json" \
  --data '{"purge_everything":true}'
```

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [æ€§èƒ½ä¼˜åŒ–è§„èŒƒ](mdc:.cursor/rules/performance-security.mdc)
- [API é…ç½®è§„èŒƒ](mdc:.cursor/rules/api-config.mdc)
- [UI ç»„ä»¶è§„èŒƒ](mdc:.cursor/rules/ui-components.mdc)
